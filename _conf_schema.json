{
    "private_settings": {
        "description": "👤 私聊全域配置",
        "type": "object",
        "items": {
            "enable": {
                "description": "✅ 啟用私聊全域主動訊息功能",
                "type": "bool",
                "default": true,
                "hint": "只有在 session_list 中明確配置的私聊才會獲得主動訊息服務，避免給未配置的會話提供服務"
            },
            "session_list": {
                "description": "📋 私聊會話 ID 列表",
                "type": "list",
                "default": [],
                "hint": "填寫 QQ 號列表，如 ['123456', '789012']，只有這些明確配置的會話才會獲得主動訊息服務"
            },
            "auto_trigger_settings": {
                "description": "🤖 自動主動訊息設定",
                "type": "object",
                "items": {
                    "enable_auto_trigger": {
                        "description": "✅ 啟用自動主動訊息功能",
                        "type": "bool",
                        "default": false,
                        "hint": "插件啟動後，如果私聊在設定時間內沒有收到訊息且沒有已存在的持久化任務，就會自動觸發一次主動訊息任務建立"
                    },
                    "auto_trigger_after_minutes": {
                        "description": "⏱️ 自動觸發等待時間（分鐘）",
                        "type": "int",
                        "default": 5,
                        "hint": "插件啟動後，如果私聊在 X 分鐘內沒有收到訊息，且當前沒有正在執行的主動訊息任務，則自動觸發一次主動訊息任務建立",
                        "slider": {
                            "min": 1,
                            "max": 120,
                            "step": 1
                        }
                    }
                }
            },
            "proactive_prompt": {
                "description": "🧠 私聊全域動機 Prompt",
                "type": "text",
                "default": "[系統任務：主動對話]\n你被授權在私聊中發起一次「主動訊息」。你的回覆必須完全符合你的人格設定，並嚴格遵守所有的輸出規則。\n\n[情景分析]\n- 我們好像已經有一段時間沒有說話了，我應該主動打破沉默，讓他知道我想他了。\n- 當前時間是: {{current_time}}。\n- 我之前已經主動找過他，但他沒有回覆的次數是: {{unanswered_count}} 次。如果這個次數大於 0，我的語氣應該帶上一點點不易察覺的失落和困惑。\n\n[行動指南]\n1. 首先，回顧我們的聊天記錄，看看我們最後在聊什麼。\n2. 如果上次的話題已經結束了，我可以關心一下他現在在做什麼。\n3. 我可以向他提出一個我一直以來都很好奇的問題。\n4. 如果實在不知道該說什麼，就直接表達我想他的心情也可以。\n\n[最終指令]\n請綜合以上所有資訊，用最像你自己的、最自然的方式，生成一句主動聊天的開場白。",
                "hint": "這段話將指導 LLM 在私聊中發起主動訊息時的思考。你可以使用 {{unanswered_count}}（未回覆次數）和 {{current_time}}（當前時間，格式如「2025年06月15日 14:30」）這兩個佔位符。建議在 Prompt 中加入 {{current_time}} 讓模型根據時間點說出對應的話題（例如早上問早安、深夜關心對方是否還沒睡）"
            },
            "schedule_settings": {
                "description": "🕒 私聊全域時間與調度設定",
                "type": "object",
                "items": {
                    "min_interval_minutes": {
                        "description": "⏱️ 最小觸發間隔（分鐘）",
                        "type": "int",
                        "default": 30,
                        "hint": "主動訊息的最小時間間隔，防止過於頻繁地打擾使用者",
                        "slider": {
                            "min": 1,
                            "max": 1440,
                            "step": 1
                        }
                    },
                    "max_interval_minutes": {
                        "description": "⏱️ 最大觸發間隔（分鐘）",
                        "type": "int",
                        "default": 900,
                        "hint": "主動訊息的最大時間間隔，確保 Bot 不會太久不主動說話",
                        "slider": {
                            "min": 1,
                            "max": 2880,
                            "step": 1
                        }
                    },
                    "quiet_hours": {
                        "description": "🌙 免打擾時段（24 小時制）",
                        "type": "string",
                        "default": "1-7",
                        "hint": "格式「開始-結束」，例如「23-7」表示晚上 11 點到早上 7 點。在此時間段內不會發送主動訊息"
                    },
                    "max_unanswered_times": {
                        "description": "⛔ 最大未回覆次數上限（硬性停止）",
                        "type": "int",
                        "default": 4,
                        "hint": "當 Bot 連續發送 N 次主動訊息使用者都未回覆後，將暫停主動訊息，直到使用者下次回覆。填 0 則不限制。若排程規則中配置了衰減率，此項作為絕對上限兜底",
                        "slider": {
                            "min": 0,
                            "max": 20,
                            "step": 1
                        }
                    },
                    "schedule_rules": {
                        "description": "📅 分時段排程規則",
                        "type": "template_list",
                        "hint": "可新增多條時段規則。每條規則定義一個時段的觸發間隔分佈，並可選配置未回覆衰減率。未匹配到任何規則時回退到上方的全域最小/最大觸發間隔",
                        "templates": {
                            "time_rule": {
                                "name": "⏰ 時段規則",
                                "hint": "定義一個時段的觸發間隔分佈與未回覆衰減策略",
                                "items": {
                                    "start_hour": {
                                        "description": "🕐 開始時間（時）",
                                        "type": "int",
                                        "default": 8,
                                        "hint": "時段開始的小時數（0-23），支援跨天如 22 到 6",
                                        "slider": {
                                            "min": 0,
                                            "max": 23,
                                            "step": 1
                                        }
                                    },
                                    "end_hour": {
                                        "description": "🕐 結束時間（時）",
                                        "type": "int",
                                        "default": 23,
                                        "hint": "時段結束的小時數（0-24），不包含該小時。填 24 表示到午夜。支援跨天如 22 到 6",
                                        "slider": {
                                            "min": 0,
                                            "max": 24,
                                            "step": 1
                                        }
                                    },
                                    "interval_weights": {
                                        "description": "📊 間隔權重分佈",
                                        "type": "text",
                                        "default": "30-60:0.3,60-120:0.4,120-240:0.2,240-480:0.1",
                                        "hint": "每組格式為「間隔下限-間隔上限:權重」（分鐘），多組用逗號分隔，權重會自動歸一化。留空則在上方全域最小/最大間隔內均勻隨機"
                                    },
                                    "decay_rate": {
                                        "description": "📉 未回覆衰減率",
                                        "type": "string",
                                        "default": "0.8,0.5,0.3,0.15",
                                        "hint": "逗號分隔的概率列表，每個值（0~1）對應第 N 次未回覆的觸發概率。例如填「0.8,0.5,0.3,0.15」表示：第 1 次 → 80%、第 2 次 → 50%、第 3 次 → 30%、第 4 次 → 15%。超出列表長度時，以下方全域預設衰減遞減步長從列表末尾值接續遞減。填單一值如「0.7」則每次未回覆都用同一概率。留空表示不衰減（100% 觸發），填「0」表示只觸發一次就停止"
                                    }
                                }
                            }
                        }
                    },
                    "default_decay_rate": {
                        "description": "📉 全域預設衰減遞減步長",
                        "type": "string",
                        "default": "0",
                        "hint": "每次未回覆時遞減的概率步長（0~1）。有兩種情境：(1) 當排程規則的衰減率列表用盡時，從列表末尾值開始接續遞減，例如列表為「1,0.9,0.8」、步長填「0.05」→ 第 4 次 75%、第 5 次 70%…；(2) 未匹配到任何規則時，從 1.0 開始遞減，例如步長填「0.05」→ 第 1 次 100%、第 2 次 95%、第 3 次 90%…以此類推直到 0%。填「0」表示不衰減（維持 100% 或列表末尾概率永遠觸發）。留空表示不使用遞減衰減（回退到硬性上限邏輯）"
                    }
                }
            },
            "tts_settings": {
                "description": "🔊 私聊全域語音合成（TTS）設定",
                "type": "object",
                "items": {
                    "enable_tts": {
                        "description": "💬 啟用 TTS 功能",
                        "type": "bool",
                        "default": true,
                        "hint": "開啟後，主動訊息會嘗試生成語音並發送"
                    },
                    "always_send_text": {
                        "description": "🔤 發送語音後是否附帶原文",
                        "type": "bool",
                        "default": true,
                        "hint": "開啟後，即使 TTS 成功發送了語音，也會再發送一條純文字原文，確保使用者能看到內容"
                    }
                }
            },
            "context_aware_settings": {
                "description": "🧠 語境感知排程設定",
                "type": "object",
                "items": {
                    "enable": {
                        "description": "✅ 啟用語境感知排程",
                        "type": "bool",
                        "default": false,
                        "hint": "開啟後，LLM 會根據對話語境動態預測下一次主動訊息的最佳觸發時間。例如用戶說「我在看電影」→ 約 1.5~2 小時後主動詢問「電影好看嗎？」。此功能與原有的隨機排程並行運作。注意：此功能會額外消耗 token"
                    },
                    "llm_provider_id": {
                        "description": "🤖 語境分析用 LLM 平台",
                        "type": "string",
                        "_special": "select_provider",
                        "default": "",
                        "hint": "指定語境分析使用的 LLM 平台。留空使用預設。建議指定較便宜的模型以節省 token",
                        "condition": { "enable": true }
                    },
                    "extra_prompt": {
                        "description": "📝 語境分析補充提示",
                        "type": "string",
                        "default": "",
                        "hint": "額外附加到語境分析 prompt 末尾的補充指示。例如：「如果用戶提到運動，延遲設為 60-90 分鐘」「不要對日常問候排程」。留空表示不附加",
                        "condition": { "enable": true }
                    },
                    "min_delay_minutes": {
                        "description": "⏱️ 最小延遲（分鐘）",
                        "type": "int",
                        "default": 5,
                        "hint": "LLM 預測的延遲時間下限，防止過於頻繁",
                        "condition": { "enable": true },
                        "slider": { "min": 1, "max": 120, "step": 1 }
                    },
                    "max_delay_minutes": {
                        "description": "⏱️ 最大延遲（分鐘）",
                        "type": "int",
                        "default": 720,
                        "hint": "LLM 預測的延遲時間上限",
                        "condition": { "enable": true },
                        "slider": { "min": 30, "max": 1440, "step": 10 }
                    },
                    "max_context_messages": {
                        "description": "📝 預測用歷史訊息數",
                        "type": "int",
                        "default": 10,
                        "hint": "傳給 LLM 進行語境分析的最近訊息數量，越多越準確但消耗更多 token。填 -1 表示不限制（全部帶上）",
                        "condition": { "enable": true },
                        "slider": { "min": -1, "max": 30, "step": 1 }
                    },
                    "enable_memory": {
                        "description": "🧠 啟用 livingmemory 記憶檢索",
                        "type": "bool",
                        "default": true,
                        "hint": "開啟後，主動訊息生成時會從 livingmemory 檢索相關記憶注入 prompt。需要安裝 astrbot_plugin_livingmemory 插件才會生效，未安裝時自動跳過",
                        "condition": { "enable": true }
                    },
                    "memory_top_k": {
                        "description": "🧠 記憶檢索數量",
                        "type": "int",
                        "default": 5,
                        "hint": "每次主動訊息生成時檢索的相關記憶條數。數量越多上下文越豐富，但消耗更多 token",
                        "condition": { "enable_memory": true },
                        "slider": { "min": 1, "max": 20, "step": 1 }
                    }
                }
            },
            "segmented_reply_settings": {
                "description": "🔪 分段回覆設定",
                "type": "object",
                "items": {
                    "enable": {
                        "description": "✅ 啟用分段回覆",
                        "type": "bool",
                        "default": false,
                        "hint": "開啟後，Bot 回覆的文字將被切分為多條短訊息發送"
                    },
                    "words_count_threshold": {
                        "description": "📏 不分段字數閾值",
                        "type": "int",
                        "default": 150,
                        "hint": "如果回覆內容字數超過此值，則不進行分段",
                        "slider": {
                            "min": 0,
                            "max": 1000,
                            "step": 1
                        }
                    },
                    "split_mode": {
                        "description": "Ⓜ️ 分段模式",
                        "type": "string",
                        "options": [
                            "regex",
                            "words"
                        ],
                        "default": "regex",
                        "labels": [
                            "正規表達式",
                            "分段詞列表"
                        ]
                    },
                    "regex": {
                        "description": "🧩 分段正規表達式",
                        "type": "string",
                        "default": ".*?[。？！~…\\n]+|.+$",
                        "condition": {
                            "split_mode": "regex"
                        }
                    },
                    "split_words": {
                        "description": "📝 分段詞列表",
                        "type": "list",
                        "default": [
                            "。",
                            "？",
                            "！",
                            "~",
                            "…"
                        ],
                        "condition": {
                            "split_mode": "words"
                        },
                        "hint": "偵測到列表中的任意詞時進行分段"
                    },
                    "interval_method": {
                        "description": "⏱️ 間隔計算方法",
                        "type": "string",
                        "options": [
                            "random",
                            "log"
                        ],
                        "default": "random",
                        "labels": [
                            "隨機",
                            "對數計算"
                        ],
                        "hint": "random：在區間內隨機；log：根據字數計算 y=log_base(x)"
                    },
                    "interval": {
                        "description": "🎲 隨機間隔（秒）",
                        "type": "string",
                        "default": "1.5, 3.5",
                        "condition": {
                            "interval_method": "random"
                        },
                        "hint": "格式：「最小, 最大」，例如「1.5, 3.5」"
                    },
                    "log_base": {
                        "description": "📈 對數底數",
                        "type": "string",
                        "default": "1.8",
                        "condition": {
                            "interval_method": "log"
                        }
                    }
                }
            }
        }
    },
    "group_settings": {
        "description": "👥 群聊全域配置",
        "type": "object",
        "items": {
            "enable": {
                "description": "✅ 啟用群聊全域主動訊息功能",
                "type": "bool",
                "default": false,
                "hint": "只有在 session_list 中明確配置的群聊才會獲得主動訊息服務，避免給未配置的會話提供服務"
            },
            "session_list": {
                "description": "📋 群聊會話 ID 列表",
                "type": "list",
                "default": [],
                "hint": "填寫群號列表，如 ['123456', '789012']，只有這些明確配置的會話才會獲得主動訊息服務"
            },
            "auto_trigger_settings": {
                "description": "🤖 自動主動訊息設定",
                "type": "object",
                "items": {
                    "enable_auto_trigger": {
                        "description": "✅ 啟用自動主動訊息功能",
                        "type": "bool",
                        "default": false,
                        "hint": "插件啟動後，如果群聊在設定時間內沒有收到訊息且沒有已存在的持久化任務，就會自動觸發一次主動訊息任務建立"
                    },
                    "auto_trigger_after_minutes": {
                        "description": "⏱️ 自動觸發等待時間（分鐘）",
                        "type": "int",
                        "default": 5,
                        "hint": "插件啟動後，如果群聊在 X 分鐘內沒有收到訊息，且當前沒有正在執行的主動訊息任務，則自動觸發一次主動訊息任務建立",
                        "slider": {
                            "min": 1,
                            "max": 120,
                            "step": 1
                        }
                    }
                }
            },
            "group_idle_trigger_minutes": {
                "description": "⏳ 群聊沉默觸發時間（分鐘）",
                "type": "int",
                "default": 30,
                "hint": "當群聊中連續 X 分鐘沒有任何新訊息時，才會開始計劃一次主動訊息",
                "slider": {
                    "min": 1,
                    "max": 1440,
                    "step": 1
                }
            },
            "proactive_prompt": {
                "description": "🧠 群聊全域動機 Prompt",
                "type": "text",
                "default": "[系統任務：群聊主動破冰]\n你被授權在群聊中發起一次「主動訊息」以活躍氣氛。你的回覆必須完全符合你的人格設定，並嚴格遵守所有的輸出規則。\n\n[情景分析]\n- 這個群聊好像已經冷清了一段時間了，我應該說些什麼來讓大家重新聊起來。\n- 當前時間是: {{current_time}}。\n- 我上次在這個群裡主動說話但沒人理我的次數是: {{unanswered_count}} 次。\n\n[行動指南]\n1. 回顧群聊的聊天記錄，看看大家最後在討論什麼有趣的話題，如果沒有聊完，嘗試延續它。\n2. 向群裡的所有人，提出一個開放性的、大家都能參與進來的問題。\n\n[最終指令]\n請綜合以上所有資訊，用最像你自己的、最自然的方式，生成一句能在群聊中打破僵局、活躍氣氛的開場白。",
                "hint": "這段話將指導 LLM 在群聊中發起主動訊息時的思考。你可以使用 {{unanswered_count}}（未回覆次數）和 {{current_time}}（當前時間，格式如「2025年06月15日 14:30」）這兩個佔位符。建議在 Prompt 中加入 {{current_time}} 讓模型根據時間點說出對應的話題（例如中午聊午餐、晚上聊下班後的事）"
            },
            "schedule_settings": {
                "description": "🕒 群聊全域時間與調度設定",
                "type": "object",
                "items": {
                    "min_interval_minutes": {
                        "description": "⏱️ 最小觸發間隔（分鐘）",
                        "type": "int",
                        "default": 90,
                        "hint": "群聊主動訊息的最小時間間隔，防止過於頻繁地打擾群成員",
                        "slider": {
                            "min": 1,
                            "max": 1440,
                            "step": 1
                        }
                    },
                    "max_interval_minutes": {
                        "description": "⏱️ 最大觸發間隔（分鐘）",
                        "type": "int",
                        "default": 360,
                        "hint": "群聊主動訊息的最大時間間隔，確保 Bot 不會太久不主動說話",
                        "slider": {
                            "min": 1,
                            "max": 2880,
                            "step": 1
                        }
                    },
                    "quiet_hours": {
                        "description": "🌙 免打擾時段（24 小時制）",
                        "type": "string",
                        "default": "2-6",
                        "hint": "格式「開始-結束」，例如「2-6」表示午夜 2 點到早上 6 點。在此時間段內不會發送主動訊息"
                    },
                    "max_unanswered_times": {
                        "description": "⛔ 最大未回覆次數上限（硬性停止）",
                        "type": "int",
                        "default": 2,
                        "hint": "當 Bot 連續發送 N 次主動訊息群成員都未回覆後，將暫停主動訊息。填 0 則不限制。若排程規則中配置了衰減率，此項作為絕對上限兜底",
                        "slider": {
                            "min": 0,
                            "max": 20,
                            "step": 1
                        }
                    },
                    "schedule_rules": {
                        "description": "📅 分時段排程規則",
                        "type": "template_list",
                        "hint": "可新增多條時段規則。每條規則定義一個時段的觸發間隔分佈，並可選配置未回覆衰減率。未匹配到任何規則時回退到上方的全域最小/最大觸發間隔",
                        "templates": {
                            "time_rule": {
                                "name": "⏰ 時段規則",
                                "hint": "定義一個時段的觸發間隔分佈與未回覆衰減策略",
                                "items": {
                                    "start_hour": {
                                        "description": "🕐 開始時間（時）",
                                        "type": "int",
                                        "default": 8,
                                        "hint": "時段開始的小時數（0-23），支援跨天如 22 到 6",
                                        "slider": {
                                            "min": 0,
                                            "max": 23,
                                            "step": 1
                                        }
                                    },
                                    "end_hour": {
                                        "description": "🕐 結束時間（時）",
                                        "type": "int",
                                        "default": 23,
                                        "hint": "時段結束的小時數（0-24），不包含該小時。填 24 表示到午夜。支援跨天如 22 到 6",
                                        "slider": {
                                            "min": 0,
                                            "max": 24,
                                            "step": 1
                                        }
                                    },
                                    "interval_weights": {
                                        "description": "📊 間隔權重分佈",
                                        "type": "text",
                                        "default": "30-60:0.3,60-120:0.4,120-240:0.2,240-480:0.1",
                                        "hint": "每組格式為「間隔下限-間隔上限:權重」（分鐘），多組用逗號分隔，權重會自動歸一化。留空則在上方全域最小/最大間隔內均勻隨機"
                                    },
                                    "decay_rate": {
                                        "description": "📉 未回覆衰減率",
                                        "type": "string",
                                        "default": "0.8,0.5,0.3,0.15",
                                        "hint": "逗號分隔的概率列表，每個值（0~1）對應第 N 次未回覆的觸發概率。例如填「0.8,0.5,0.3,0.15」表示：第 1 次 → 80%、第 2 次 → 50%、第 3 次 → 30%、第 4 次 → 15%。超出列表長度時，以下方全域預設衰減遞減步長從列表末尾值接續遞減。填單一值如「0.7」則每次未回覆都用同一概率。留空表示不衰減（100% 觸發），填「0」表示只觸發一次就停止"
                                    }
                                }
                            }
                        }
                    },
                    "default_decay_rate": {
                        "description": "📉 全域預設衰減遞減步長",
                        "type": "string",
                        "default": "0",
                        "hint": "每次未回覆時遞減的概率步長（0~1）。有兩種情境：(1) 當排程規則的衰減率列表用盡時，從列表末尾值開始接續遞減，例如列表為「1,0.9,0.8」、步長填「0.05」→ 第 4 次 75%、第 5 次 70%…；(2) 未匹配到任何規則時，從 1.0 開始遞減，例如步長填「0.05」→ 第 1 次 100%、第 2 次 95%、第 3 次 90%…以此類推直到 0%。填「0」表示不衰減（維持 100% 或列表末尾概率永遠觸發）。留空表示不使用遞減衰減（回退到硬性上限邏輯）"
                    }
                }
            },
            "tts_settings": {
                "description": "🔊 群聊全域語音合成（TTS）設定",
                "type": "object",
                "items": {
                    "enable_tts": {
                        "description": "💬 啟用群聊的 TTS 功能",
                        "type": "bool",
                        "default": false,
                        "hint": "開啟後，群聊主動訊息會嘗試生成語音並發送"
                    },
                    "always_send_text": {
                        "description": "🔤 發送語音後是否附帶原文",
                        "type": "bool",
                        "default": true,
                        "hint": "開啟後，即使 TTS 成功發送了語音，也會再發送一條純文字原文，確保所有人都能看到內容"
                    }
                }
            },
            "context_aware_settings": {
                "description": "🧠 語境感知排程設定",
                "type": "object",
                "items": {
                    "enable": {
                        "description": "✅ 啟用語境感知排程",
                        "type": "bool",
                        "default": false,
                        "hint": "開啟後，LLM 會根據對話語境動態預測下一次主動訊息的最佳觸發時間。例如群友說「我去開會了」→ 約 30~90 分鐘後關心會議情況。此功能與原有的隨機排程並行運作。注意：此功能會額外消耗 token"
                    },
                    "llm_provider_id": {
                        "description": "🤖 語境分析用 LLM 平台",
                        "type": "string",
                        "_special": "select_provider",
                        "default": "",
                        "hint": "指定語境分析使用的 LLM 平台。留空使用預設。建議指定較便宜的模型以節省 token",
                        "condition": { "enable": true }
                    },
                    "extra_prompt": {
                        "description": "📝 語境分析補充提示",
                        "type": "string",
                        "default": "",
                        "hint": "額外附加到語境分析 prompt 末尾的補充指示。例如：「如果用戶提到運動，延遲設為 60-90 分鐘」「不要對日常問候排程」。留空表示不附加",
                        "condition": { "enable": true }
                    },
                    "min_delay_minutes": {
                        "description": "⏱️ 最小延遲（分鐘）",
                        "type": "int",
                        "default": 5,
                        "hint": "LLM 預測的延遲時間下限，防止過於頻繁",
                        "condition": { "enable": true },
                        "slider": { "min": 1, "max": 120, "step": 1 }
                    },
                    "max_delay_minutes": {
                        "description": "⏱️ 最大延遲（分鐘）",
                        "type": "int",
                        "default": 720,
                        "hint": "LLM 預測的延遲時間上限",
                        "condition": { "enable": true },
                        "slider": { "min": 30, "max": 1440, "step": 10 }
                    },
                    "max_context_messages": {
                        "description": "📝 預測用歷史訊息數",
                        "type": "int",
                        "default": 10,
                        "hint": "傳給 LLM 進行語境分析的最近訊息數量，越多越準確但消耗更多 token。填 -1 表示不限制（全部帶上）",
                        "condition": { "enable": true },
                        "slider": { "min": -1, "max": 30, "step": 1 }
                    },
                    "enable_memory": {
                        "description": "🧠 啟用 livingmemory 記憶檢索",
                        "type": "bool",
                        "default": true,
                        "hint": "開啟後，主動訊息生成時會從 livingmemory 檢索相關記憶注入 prompt。需要安裝 astrbot_plugin_livingmemory 插件才會生效，未安裝時自動跳過",
                        "condition": { "enable": true }
                    },
                    "memory_top_k": {
                        "description": "🧠 記憶檢索數量",
                        "type": "int",
                        "default": 5,
                        "hint": "每次主動訊息生成時檢索的相關記憶條數。數量越多上下文越豐富，但消耗更多 token",
                        "condition": { "enable_memory": true },
                        "slider": { "min": 1, "max": 20, "step": 1 }
                    }
                }
            },
            "segmented_reply_settings": {
                "description": "🔪 分段回覆設定",
                "type": "object",
                "items": {
                    "enable": {
                        "description": "✅ 啟用分段回覆",
                        "type": "bool",
                        "default": false,
                        "hint": "開啟後，Bot 回覆的文字將被切分為多條短訊息發送"
                    },
                    "words_count_threshold": {
                        "description": "📏 不分段字數閾值",
                        "type": "int",
                        "default": 150,
                        "hint": "如果回覆內容字數超過此值，則不進行分段",
                        "slider": {
                            "min": 0,
                            "max": 1000,
                            "step": 1
                        }
                    },
                    "split_mode": {
                        "description": "Ⓜ️ 分段模式",
                        "type": "string",
                        "options": [
                            "regex",
                            "words"
                        ],
                        "default": "regex",
                        "labels": [
                            "正規表達式",
                            "分段詞列表"
                        ]
                    },
                    "regex": {
                        "description": "🧩 分段正規表達式",
                        "type": "string",
                        "default": ".*?[。？！~…\\n]+|.+$",
                        "condition": {
                            "split_mode": "regex"
                        }
                    },
                    "split_words": {
                        "description": "📝 分段詞列表",
                        "type": "list",
                        "default": [
                            "。",
                            "？",
                            "！",
                            "~",
                            "…"
                        ],
                        "condition": {
                            "split_mode": "words"
                        },
                        "hint": "偵測到列表中的任意詞時進行分段"
                    },
                    "interval_method": {
                        "description": "⏱️ 間隔計算方法",
                        "type": "string",
                        "options": [
                            "random",
                            "log"
                        ],
                        "default": "random",
                        "labels": [
                            "隨機",
                            "對數計算"
                        ],
                        "hint": "random：在區間內隨機；log：根據字數計算 y=log_base(x)"
                    },
                    "interval": {
                        "description": "🎲 隨機間隔（秒）",
                        "type": "string",
                        "default": "1.5, 3.5",
                        "condition": {
                            "interval_method": "random"
                        },
                        "hint": "格式：「最小, 最大」，例如「1.5, 3.5」"
                    },
                    "log_base": {
                        "description": "📈 對數底數",
                        "type": "string",
                        "default": "1.8",
                        "condition": {
                            "interval_method": "log"
                        }
                    }
                }
            }
        }
    },
    "private_sessions": {
        "description": "👤 私聊會話列表",
        "type": "template_list",
        "templates": {
            "private_session": {
                "name": "私聊會話",
                "hint": "新增一個私聊會話配置",
                "items": {
                    "session_id": {
                        "description": "🎯 QQ 號",
                        "type": "string",
                        "default": "",
                        "hint": "填寫 QQ 號，如 123456"
                    },
                    "session_name": {
                        "description": "🏷️ 會話備註名",
                        "type": "string",
                        "default": "",
                        "hint": "用於快速識別這個會話"
                    },
                    "enable": {
                        "description": "✅ 啟用此私聊會話",
                        "type": "bool",
                        "default": false,
                        "hint": "開啟後，Bot 會主動給這個使用者發送訊息"
                    },
                    "auto_trigger_settings": {
                        "description": "🤖 自動主動訊息設定",
                        "type": "object",
                        "items": {
                            "enable_auto_trigger": {
                                "description": "✅ 啟用自動主動訊息功能",
                                "type": "bool",
                                "default": false,
                                "hint": "插件啟動後，如果私聊在設定時間內沒有收到訊息且沒有已存在的持久化任務，就會自動觸發一次主動訊息任務建立"
                            },
                            "auto_trigger_after_minutes": {
                                "description": "⏱️ 自動觸發等待時間（分鐘）",
                                "type": "int",
                                "default": 5,
                                "hint": "插件啟動後，如果私聊在 X 分鐘內沒有收到訊息，且當前沒有正在執行的主動訊息任務，則自動觸發一次主動訊息任務建立",
                                "slider": {
                                    "min": 1,
                                    "max": 120,
                                    "step": 1
                                }
                            }
                        }
                    },
                    "proactive_prompt": {
                        "description": "🧠 私聊動機 Prompt",
                        "type": "text",
                        "default": "[系統任務：主動對話]\n你被授權在私聊中發起一次「主動訊息」。你的回覆必須完全符合你的人格設定，並嚴格遵守所有的輸出規則。\n\n[情景分析]\n- 我們好像已經有一段時間沒有說話了，我應該主動打破沉默，讓他知道我想他了。\n- 當前時間是: {{current_time}}。\n- 我之前已經主動找過他，但他沒有回覆的次數是: {{unanswered_count}} 次。如果這個次數大於 0，我的語氣應該帶上一點點不易察覺的失落和困惑。\n\n[行動指南]\n1. 首先，回顧我們的聊天記錄，看看我們最後在聊什麼。\n2. 如果上次的話題已經結束了，我可以關心一下他現在在做什麼。\n3. 我可以向他提出一個我一直以來都很好奇的問題。\n4. 如果實在不知道該說什麼，就直接表達我想他的心情也可以。\n\n[最終指令]\n請綜合以上所有資訊，用最像你自己的、最自然的方式，生成一句主動聊天的開場白。",
                        "hint": "這段話將指導 LLM 在私聊中發起主動訊息時的思考。你可以使用 {{unanswered_count}}（未回覆次數）和 {{current_time}}（當前時間，格式如「2025年06月15日 14:30」）這兩個佔位符。建議在 Prompt 中加入 {{current_time}} 讓模型根據時間點說出對應的話題（例如早上問早安、深夜關心對方是否還沒睡）"
                    },
                    "schedule_settings": {
                        "description": "🕒 時間與調度設定",
                        "type": "object",
                        "items": {
                            "min_interval_minutes": {
                                "description": "⏱️ 最小觸發間隔（分鐘）",
                                "type": "int",
                                "default": 30,
                                "hint": "主動訊息的最小時間間隔，防止過於頻繁地打擾使用者",
                                "slider": {
                                    "min": 1,
                                    "max": 1440,
                                    "step": 1
                                }
                            },
                            "max_interval_minutes": {
                                "description": "⏱️ 最大觸發間隔（分鐘）",
                                "type": "int",
                                "default": 900,
                                "hint": "主動訊息的最大時間間隔，確保 Bot 不會太久不主動說話",
                                "slider": {
                                    "min": 1,
                                    "max": 2880,
                                    "step": 1
                                }
                            },
                            "quiet_hours": {
                                "description": "🌙 免打擾時段（24 小時制）",
                                "type": "string",
                                "default": "1-7",
                                "hint": "格式「開始-結束」，例如「23-7」表示晚上 11 點到早上 7 點。在此時間段內不會發送主動訊息"
                            },
                            "max_unanswered_times": {
                                "description": "⛔ 最大未回覆次數上限（硬性停止）",
                                "type": "int",
                                "default": 4,
                                "hint": "當 Bot 連續發送 N 次主動訊息使用者都未回覆後，將暫停主動訊息，直到使用者下次回覆。填 0 則不限制。若排程規則中配置了衰減率，此項作為絕對上限兜底",
                                "slider": {
                                    "min": 0,
                                    "max": 20,
                                    "step": 1
                                }
                            },
                            "schedule_rules": {
                                "description": "📅 分時段排程規則",
                                "type": "template_list",
                                "hint": "可新增多條時段規則。每條規則定義一個時段的觸發間隔分佈，並可選配置未回覆衰減率。未匹配到任何規則時回退到上方的全域最小/最大觸發間隔",
                                "templates": {
                                    "time_rule": {
                                        "name": "⏰ 時段規則",
                                        "hint": "定義一個時段的觸發間隔分佈與未回覆衰減策略",
                                        "items": {
                                            "start_hour": {
                                                "description": "🕐 開始時間（時）",
                                                "type": "int",
                                                "default": 8,
                                                "hint": "時段開始的小時數（0-23），支援跨天如 22 到 6",
                                                "slider": {
                                                    "min": 0,
                                                    "max": 23,
                                                    "step": 1
                                                }
                                            },
                                            "end_hour": {
                                                "description": "🕐 結束時間（時）",
                                                "type": "int",
                                                "default": 23,
                                                "hint": "時段結束的小時數（0-24），不包含該小時。填 24 表示到午夜。支援跨天如 22 到 6",
                                                "slider": {
                                                    "min": 0,
                                                    "max": 24,
                                                    "step": 1
                                                }
                                            },
                                            "interval_weights": {
                                                "description": "📊 間隔權重分佈",
                                                "type": "text",
                                                "default": "30-60:0.3,60-120:0.4,120-240:0.2,240-480:0.1",
                                                "hint": "每組格式為「間隔下限-間隔上限:權重」（分鐘），多組用逗號分隔，權重會自動歸一化。留空則在上方全域最小/最大間隔內均勻隨機"
                                            },
                                            "decay_rate": {
                                                "description": "📉 未回覆衰減率",
                                                "type": "string",
                                                "default": "0.8,0.5,0.3,0.15",
                                                "hint": "逗號分隔的概率列表，每個值（0~1）對應第 N 次未回覆的觸發概率。例如填「0.8,0.5,0.3,0.15」表示：第 1 次 → 80%、第 2 次 → 50%、第 3 次 → 30%、第 4 次 → 15%。超出列表長度時，以下方全域預設衰減遞減步長從列表末尾值接續遞減。填單一值如「0.7」則每次未回覆都用同一概率。留空表示不衰減（100% 觸發），填「0」表示只觸發一次就停止"
                                            }
                                        }
                                    }
                                }
                            },
                            "default_decay_rate": {
                                "description": "📉 全域預設衰減遞減步長",
                                "type": "string",
                                "default": "0",
                                "hint": "每次未回覆時遞減的概率步長（0~1）。有兩種情境：(1) 當排程規則的衰減率列表用盡時，從列表末尾值開始接續遞減，例如列表為「1,0.9,0.8」、步長填「0.05」→ 第 4 次 75%、第 5 次 70%…；(2) 未匹配到任何規則時，從 1.0 開始遞減，例如步長填「0.05」→ 第 1 次 100%、第 2 次 95%、第 3 次 90%…以此類推直到 0%。填「0」表示不衰減（維持 100% 或列表末尾概率永遠觸發）。留空表示不使用遞減衰減（回退到硬性上限邏輯）"
                            }
                        }
                    },
                    "tts_settings": {
                        "description": "🔊 語音合成（TTS）設定",
                        "type": "object",
                        "items": {
                            "enable_tts": {
                                "description": "💬 啟用 TTS 功能",
                                "type": "bool",
                                "default": true,
                                "hint": "開啟後，主動訊息會嘗試生成語音並發送"
                            },
                            "always_send_text": {
                                "description": "🔤 發送語音後是否附帶原文",
                                "type": "bool",
                                "default": true,
                                "hint": "開啟後，即使 TTS 成功發送了語音，也會再發送一條純文字原文，確保使用者能看到內容"
                            }
                        }
                    },
                    "context_aware_settings": {
                        "description": "🧠 語境感知排程設定",
                        "type": "object",
                        "items": {
                            "enable": {
                                "description": "✅ 啟用語境感知排程",
                                "type": "bool",
                                "default": false,
                                "hint": "開啟後，LLM 會根據對話語境動態預測下一次主動訊息的最佳觸發時間。例如用戶說「我在看電影」→ 約 1.5~2 小時後主動詢問「電影好看嗎？」。此功能與原有的隨機排程並行運作。注意：此功能會額外消耗 token"
                            },
                            "llm_provider_id": {
                                "description": "🤖 語境分析用 LLM 平台",
                                "type": "string",
                                "_special": "select_provider",
                                "default": "",
                                "hint": "指定語境分析使用的 LLM 平台。留空使用預設。建議指定較便宜的模型以節省 token",
                                "condition": { "enable": true }
                            },
                            "extra_prompt": {
                                "description": "📝 語境分析補充提示",
                                "type": "string",
                                "default": "",
                                "hint": "額外附加到語境分析 prompt 末尾的補充指示。例如：「如果用戶提到運動，延遲設為 60-90 分鐘」「不要對日常問候排程」。留空表示不附加",
                                "condition": { "enable": true }
                            },
                            "min_delay_minutes": {
                                "description": "⏱️ 最小延遲（分鐘）",
                                "type": "int",
                                "default": 5,
                                "hint": "LLM 預測的延遲時間下限，防止過於頻繁",
                                "condition": { "enable": true },
                                "slider": { "min": 1, "max": 120, "step": 1 }
                            },
                            "max_delay_minutes": {
                                "description": "⏱️ 最大延遲（分鐘）",
                                "type": "int",
                                "default": 720,
                                "hint": "LLM 預測的延遲時間上限",
                                "condition": { "enable": true },
                                "slider": { "min": 30, "max": 1440, "step": 10 }
                            },
                            "max_context_messages": {
                                "description": "📝 預測用歷史訊息數",
                                "type": "int",
                                "default": 10,
                                "hint": "傳給 LLM 進行語境分析的最近訊息數量，越多越準確但消耗更多 token。填 -1 表示不限制（全部帶上）",
                                "condition": { "enable": true },
                                "slider": { "min": -1, "max": 30, "step": 1 }
                            },
                            "enable_memory": {
                                "description": "🧠 啟用 livingmemory 記憶檢索",
                                "type": "bool",
                                "default": true,
                                "hint": "開啟後，主動訊息生成時會從 livingmemory 檢索相關記憶注入 prompt。需要安裝 astrbot_plugin_livingmemory 插件才會生效，未安裝時自動跳過",
                                "condition": { "enable": true }
                            },
                            "memory_top_k": {
                                "description": "🧠 記憶檢索數量",
                                "type": "int",
                                "default": 5,
                                "hint": "每次主動訊息生成時檢索的相關記憶條數。數量越多上下文越豐富，但消耗更多 token",
                                "condition": { "enable_memory": true },
                                "slider": { "min": 1, "max": 20, "step": 1 }
                            }
                        }
                    },
                    "segmented_reply_settings": {
                        "description": "🔪 分段回覆設定",
                        "type": "object",
                        "items": {
                            "enable": {
                                "description": "✅ 啟用分段回覆",
                                "type": "bool",
                                "default": false,
                                "hint": "開啟後，Bot 回覆的文字將被切分為多條短訊息發送"
                            },
                            "words_count_threshold": {
                                "description": "📏 不分段字數閾值",
                                "type": "int",
                                "default": 150,
                                "hint": "如果回覆內容字數超過此值，則不進行分段",
                                "slider": {
                                    "min": 0,
                                    "max": 1000,
                                    "step": 1
                                }
                            },
                            "split_mode": {
                                "description": "Ⓜ️ 分段模式",
                                "type": "string",
                                "options": [
                                    "regex",
                                    "words"
                                ],
                                "default": "regex",
                                "labels": [
                                    "正規表達式",
                                    "分段詞列表"
                                ]
                            },
                            "regex": {
                                "description": "🧩 分段正規表達式",
                                "type": "string",
                                "default": ".*?[。？！~…\\n]+|.+$",
                                "condition": {
                                    "split_mode": "regex"
                                }
                            },
                            "split_words": {
                                "description": "📝 分段詞列表",
                                "type": "list",
                                "default": [
                                    "。",
                                    "？",
                                    "！",
                                    "~",
                                    "…"
                                ],
                                "condition": {
                                    "split_mode": "words"
                                },
                                "hint": "偵測到列表中的任意詞時進行分段"
                            },
                            "interval_method": {
                                "description": "⏱️ 間隔計算方法",
                                "type": "string",
                                "options": [
                                    "random",
                                    "log"
                                ],
                                "default": "random",
                                "labels": [
                                    "隨機",
                                    "對數計算"
                                ],
                                "hint": "random：在區間內隨機；log：根據字數計算 y=log_base(x)"
                            },
                            "interval": {
                                "description": "🎲 隨機間隔（秒）",
                                "type": "string",
                                "default": "1.5, 3.5",
                                "condition": {
                                    "interval_method": "random"
                                },
                                "hint": "格式：「最小, 最大」，例如「1.5, 3.5」"
                            },
                            "log_base": {
                                "description": "📈 對數底數",
                                "type": "string",
                                "default": "1.8",
                                "condition": {
                                    "interval_method": "log"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "group_sessions": {
        "description": "👥 群聊會話列表",
        "type": "template_list",
        "templates": {
            "group_session": {
                "name": "群聊會話",
                "hint": "新增一個群聊會話配置",
                "items": {
                    "session_id": {
                        "description": "🎯 群號",
                        "type": "string",
                        "default": "",
                        "hint": "填寫群號，如 123456"
                    },
                    "session_name": {
                        "description": "🏷️ 會話備註名",
                        "type": "string",
                        "default": "",
                        "hint": "用於快速識別這個會話"
                    },
                    "enable": {
                        "description": "✅ 啟用此群聊會話",
                        "type": "bool",
                        "default": false,
                        "hint": "開啟後，當此群聊沉默達到設定時間時，Bot 會主動發送訊息活躍氣氛"
                    },
                    "auto_trigger_settings": {
                        "description": "🤖 自動主動訊息設定",
                        "type": "object",
                        "items": {
                            "enable_auto_trigger": {
                                "description": "✅ 啟用自動主動訊息功能",
                                "type": "bool",
                                "default": false,
                                "hint": "插件啟動後，如果群聊在設定時間內沒有收到訊息且沒有已存在的持久化任務，就會自動觸發一次主動訊息任務建立"
                            },
                            "auto_trigger_after_minutes": {
                                "description": "⏱️ 自動觸發等待時間（分鐘）",
                                "type": "int",
                                "default": 5,
                                "hint": "插件啟動後，如果群聊在 X 分鐘內沒有收到訊息，且當前沒有正在執行的主動訊息任務，則自動觸發一次主動訊息任務建立",
                                "slider": {
                                    "min": 1,
                                    "max": 120,
                                    "step": 1
                                }
                            }
                        }
                    },
                    "group_idle_trigger_minutes": {
                        "description": "⏳ 群聊沉默觸發時間（分鐘）",
                        "type": "int",
                        "default": 30,
                        "hint": "當群聊中連續 X 分鐘沒有任何新訊息時，才會開始計劃一次主動訊息",
                        "slider": {
                            "min": 1,
                            "max": 1440,
                            "step": 1
                        }
                    },
                    "proactive_prompt": {
                        "description": "🧠 群聊動機 Prompt",
                        "type": "text",
                        "default": "[系統任務：群聊主動破冰]\n你被授權在群聊中發起一次「主動訊息」以活躍氣氛。你的回覆必須完全符合你的人格設定，並嚴格遵守所有的輸出規則。\n\n[情景分析]\n- 這個群聊好像已經冷清了一段時間了，我應該說些什麼來讓大家重新聊起來。\n- 當前時間是: {{current_time}}。\n- 我上次在這個群裡主動說話但沒人理我的次數是: {{unanswered_count}} 次。\n\n[行動指南]\n1. 回顧群聊的聊天記錄，看看大家最後在討論什麼有趣的話題，如果沒有聊完，嘗試延續它。\n2. 向群裡的所有人，提出一個開放性的、大家都能參與進來的問題。\n\n[最終指令]\n請綜合以上所有資訊，用最像你自己的、最自然的方式，生成一句能在群聊中打破僵局、活躍氣氛的開場白。",
                        "hint": "這段話將指導 LLM 在群聊中發起主動訊息時的思考。你可以使用 {{unanswered_count}}（未回覆次數）和 {{current_time}}（當前時間，格式如「2025年06月15日 14:30」）這兩個佔位符。建議在 Prompt 中加入 {{current_time}} 讓模型根據時間點說出對應的話題（例如中午聊午餐、晚上聊下班後的事）"
                    },
                    "schedule_settings": {
                        "description": "🕒 時間與調度設定",
                        "type": "object",
                        "items": {
                            "min_interval_minutes": {
                                "description": "⏱️ 最小觸發間隔（分鐘）",
                                "type": "int",
                                "default": 90,
                                "hint": "群聊主動訊息的最小時間間隔，防止過於頻繁地打擾群成員",
                                "slider": {
                                    "min": 1,
                                    "max": 1440,
                                    "step": 1
                                }
                            },
                            "max_interval_minutes": {
                                "description": "⏱️ 最大觸發間隔（分鐘）",
                                "type": "int",
                                "default": 360,
                                "hint": "群聊主動訊息的最大時間間隔，確保 Bot 不會太久不主動說話",
                                "slider": {
                                    "min": 1,
                                    "max": 2880,
                                    "step": 1
                                }
                            },
                            "quiet_hours": {
                                "description": "🌙 免打擾時段（24 小時制）",
                                "type": "string",
                                "default": "2-6",
                                "hint": "格式「開始-結束」，例如「2-6」表示午夜 2 點到早上 6 點。在此時間段內不會發送主動訊息"
                            },
                            "max_unanswered_times": {
                                "description": "⛔ 最大未回覆次數上限（硬性停止）",
                                "type": "int",
                                "default": 2,
                                "hint": "當 Bot 連續發送 N 次主動訊息群成員都未回覆後，將暫停主動訊息。填 0 則不限制。若排程規則中配置了衰減率，此項作為絕對上限兜底",
                                "slider": {
                                    "min": 0,
                                    "max": 20,
                                    "step": 1
                                }
                            },
                            "schedule_rules": {
                                "description": "📅 分時段排程規則",
                                "type": "template_list",
                                "hint": "可新增多條時段規則。每條規則定義一個時段的觸發間隔分佈，並可選配置未回覆衰減率。未匹配到任何規則時回退到上方的全域最小/最大觸發間隔",
                                "templates": {
                                    "time_rule": {
                                        "name": "⏰ 時段規則",
                                        "hint": "定義一個時段的觸發間隔分佈與未回覆衰減策略",
                                        "items": {
                                            "start_hour": {
                                                "description": "🕐 開始時間（時）",
                                                "type": "int",
                                                "default": 8,
                                                "hint": "時段開始的小時數（0-23），支援跨天如 22 到 6",
                                                "slider": {
                                                    "min": 0,
                                                    "max": 23,
                                                    "step": 1
                                                }
                                            },
                                            "end_hour": {
                                                "description": "🕐 結束時間（時）",
                                                "type": "int",
                                                "default": 23,
                                                "hint": "時段結束的小時數（0-24），不包含該小時。填 24 表示到午夜。支援跨天如 22 到 6",
                                                "slider": {
                                                    "min": 0,
                                                    "max": 24,
                                                    "step": 1
                                                }
                                            },
                                            "interval_weights": {
                                                "description": "📊 間隔權重分佈",
                                                "type": "text",
                                                "default": "30-60:0.3,60-120:0.4,120-240:0.2,240-480:0.1",
                                                "hint": "每組格式為「間隔下限-間隔上限:權重」（分鐘），多組用逗號分隔，權重會自動歸一化。留空則在上方全域最小/最大間隔內均勻隨機"
                                            },
                                            "decay_rate": {
                                                "description": "📉 未回覆衰減率",
                                                "type": "string",
                                                "default": "0.8,0.5,0.3,0.15",
                                                "hint": "逗號分隔的概率列表，每個值（0~1）對應第 N 次未回覆的觸發概率。例如填「0.8,0.5,0.3,0.15」表示：第 1 次 → 80%、第 2 次 → 50%、第 3 次 → 30%、第 4 次 → 15%。超出列表長度時，以下方全域預設衰減遞減步長從列表末尾值接續遞減。填單一值如「0.7」則每次未回覆都用同一概率。留空表示不衰減（100% 觸發），填「0」表示只觸發一次就停止"
                                            }
                                        }
                                    }
                                }
                            },
                            "default_decay_rate": {
                                "description": "📉 全域預設衰減遞減步長",
                                "type": "string",
                                "default": "0",
                                "hint": "每次未回覆時遞減的概率步長（0~1）。有兩種情境：(1) 當排程規則的衰減率列表用盡時，從列表末尾值開始接續遞減，例如列表為「1,0.9,0.8」、步長填「0.05」→ 第 4 次 75%、第 5 次 70%…；(2) 未匹配到任何規則時，從 1.0 開始遞減，例如步長填「0.05」→ 第 1 次 100%、第 2 次 95%、第 3 次 90%…以此類推直到 0%。填「0」表示不衰減（維持 100% 或列表末尾概率永遠觸發）。留空表示不使用遞減衰減（回退到硬性上限邏輯）"
                            }
                        }
                    },
                    "tts_settings": {
                        "description": "🔊 語音合成（TTS）設定",
                        "type": "object",
                        "items": {
                            "enable_tts": {
                                "description": "💬 啟用群聊的 TTS 功能",
                                "type": "bool",
                                "default": false,
                                "hint": "開啟後，群聊主動訊息會嘗試生成語音並發送"
                            },
                            "always_send_text": {
                                "description": "🔤 發送語音後是否附帶原文",
                                "type": "bool",
                                "default": true,
                                "hint": "開啟後，即使 TTS 成功發送了語音，也會再發送一條純文字原文，確保所有人都能看到內容"
                            }
                        }
                    },
                    "context_aware_settings": {
                        "description": "🧠 語境感知排程設定",
                        "type": "object",
                        "items": {
                            "enable": {
                                "description": "✅ 啟用語境感知排程",
                                "type": "bool",
                                "default": false,
                                "hint": "開啟後，LLM 會根據對話語境動態預測下一次主動訊息的最佳觸發時間。例如群友說「我去開會了」→ 約 30~90 分鐘後關心會議情況。此功能與原有的隨機排程並行運作。注意：此功能會額外消耗 token"
                            },
                            "llm_provider_id": {
                                "description": "🤖 語境分析用 LLM 平台",
                                "type": "string",
                                "_special": "select_provider",
                                "default": "",
                                "hint": "指定語境分析使用的 LLM 平台。留空使用預設。建議指定較便宜的模型以節省 token",
                                "condition": { "enable": true }
                            },
                            "extra_prompt": {
                                "description": "📝 語境分析補充提示",
                                "type": "string",
                                "default": "",
                                "hint": "額外附加到語境分析 prompt 末尾的補充指示。例如：「如果用戶提到運動，延遲設為 60-90 分鐘」「不要對日常問候排程」。留空表示不附加",
                                "condition": { "enable": true }
                            },
                            "min_delay_minutes": {
                                "description": "⏱️ 最小延遲（分鐘）",
                                "type": "int",
                                "default": 5,
                                "hint": "LLM 預測的延遲時間下限，防止過於頻繁",
                                "condition": { "enable": true },
                                "slider": { "min": 1, "max": 120, "step": 1 }
                            },
                            "max_delay_minutes": {
                                "description": "⏱️ 最大延遲（分鐘）",
                                "type": "int",
                                "default": 720,
                                "hint": "LLM 預測的延遲時間上限",
                                "condition": { "enable": true },
                                "slider": { "min": 30, "max": 1440, "step": 10 }
                            },
                            "max_context_messages": {
                                "description": "📝 預測用歷史訊息數",
                                "type": "int",
                                "default": 10,
                                "hint": "傳給 LLM 進行語境分析的最近訊息數量，越多越準確但消耗更多 token。填 -1 表示不限制（全部帶上）",
                                "condition": { "enable": true },
                                "slider": { "min": -1, "max": 30, "step": 1 }
                            },
                            "enable_memory": {
                                "description": "🧠 啟用 livingmemory 記憶檢索",
                                "type": "bool",
                                "default": true,
                                "hint": "開啟後，主動訊息生成時會從 livingmemory 檢索相關記憶注入 prompt。需要安裝 astrbot_plugin_livingmemory 插件才會生效，未安裝時自動跳過",
                                "condition": { "enable": true }
                            },
                            "memory_top_k": {
                                "description": "🧠 記憶檢索數量",
                                "type": "int",
                                "default": 5,
                                "hint": "每次主動訊息生成時檢索的相關記憶條數。數量越多上下文越豐富，但消耗更多 token",
                                "condition": { "enable_memory": true },
                                "slider": { "min": 1, "max": 20, "step": 1 }
                            }
                        }
                    },
                    "segmented_reply_settings": {
                        "description": "🔪 分段回覆設定",
                        "type": "object",
                        "items": {
                            "enable": {
                                "description": "✅ 啟用分段回覆",
                                "type": "bool",
                                "default": false,
                                "hint": "開啟後，Bot 回覆的文字將被切分為多條短訊息發送"
                            },
                            "words_count_threshold": {
                                "description": "📏 不分段字數閾值",
                                "type": "int",
                                "default": 150,
                                "hint": "如果回覆內容字數超過此值，則不進行分段",
                                "slider": {
                                    "min": 0,
                                    "max": 1000,
                                    "step": 1
                                }
                            },
                            "split_mode": {
                                "description": "Ⓜ️ 分段模式",
                                "type": "string",
                                "options": [
                                    "regex",
                                    "words"
                                ],
                                "default": "regex",
                                "labels": [
                                    "正規表達式",
                                    "分段詞列表"
                                ]
                            },
                            "regex": {
                                "description": "🧩 分段正規表達式",
                                "type": "string",
                                "default": ".*?[。？！~…\\n]+|.+$",
                                "condition": {
                                    "split_mode": "regex"
                                }
                            },
                            "split_words": {
                                "description": "📝 分段詞列表",
                                "type": "list",
                                "default": [
                                    "。",
                                    "？",
                                    "！",
                                    "~",
                                    "…"
                                ],
                                "condition": {
                                    "split_mode": "words"
                                },
                                "hint": "偵測到列表中的任意詞時進行分段"
                            },
                            "interval_method": {
                                "description": "⏱️ 間隔計算方法",
                                "type": "string",
                                "options": [
                                    "random",
                                    "log"
                                ],
                                "default": "random",
                                "labels": [
                                    "隨機",
                                    "對數計算"
                                ],
                                "hint": "random：在區間內隨機；log：根據字數計算 y=log_base(x)"
                            },
                            "interval": {
                                "description": "🎲 隨機間隔（秒）",
                                "type": "string",
                                "default": "1.5, 3.5",
                                "condition": {
                                    "interval_method": "random"
                                },
                                "hint": "格式：「最小, 最大」，例如「1.5, 3.5」"
                            },
                            "log_base": {
                                "description": "📈 對數底數",
                                "type": "string",
                                "default": "1.8",
                                "condition": {
                                    "interval_method": "log"
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}